{% extends 'content.html' %}

{% block title %}
    Корзина – {{ block.super }}
{% endblock %}


{% block heading %}
    Корзина
{% endblock %}

{% block inner %}
    {% if cart %}
        <table class="cart" style="margin-top: 50px">
            <thead class="cart__head">
                <tr>
                    <th class="cart__col">
                        Товаров: <span class="cart-counter">{{ cart|length }}</span>
                    </th>
                    <th class="cart__col">
                        Размер
                    </th>
                    <th class="cart__col">
                        Количество
                    </th>
                    <th class="cart__col">
                        Стоимость
                    </th>
                    <th class="cart__col">
                        Итого
                    </th>
                    <th class="cart__col"></th>
                </tr>
            </thead>

            <tbody class="cart__body">
                {% for item in cart %}
                    {% with variation=item.variation product=item.variation.product %}
                        <tr data-variation-id="{{ variation.id }}">
                            <td class="cart__col">
                                <a class="cart-product" href="{{ product.get_absolute_url }}">
                                    <img class="cart-product__image" src="{{ product.thumbnail_url }}" alt="{{ product.name }}">

                                    <div class="cart-product__content">
                                        <div class="cart-product__title">
                                            {{ product.name }}
                                        </div>
                                        <div class="cart-product__param">
                                            Артикул: {{ product.sku }}
                                        </div>
                                    </div>
                                </a>
                            </td>
                            <td class="cart__col">
                                {{ variation.size.value }}
                            </td>
                            <td class="cart__col">
                                <form class="cart-update-form" action="{% url 'cart:update' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                    <input type="hidden" name="variation_id" value="{{ variation.id }}">

                                    <div class="qty-input">
                                        <button class="qty-input__btn qty-input__btn--down" type="submit" name="do" value="remove">
                                            -
                                        </button>

                                        <input class="qty-input__field cart-item-qty" type="text" name="quantity" value="{{ item.quantity }}" readonly>

                                        <button class="qty-input__btn qty-input__btn--up" type="submit" name="do" value="add">
                                            +
                                        </button>
                                    </div>
                                </form>
                            </td>
                            <td class="cart__col">
                                {{ product.price }} ₽
                            </td>
                            <td class="cart__col cart__col--bold">
                                <span class="cart-item-price">{{ item.total_price }}</span> ₽
                            </td>
                            <td class="cart__col">
                                <form class="cart-remove-form" action="{% url 'cart:remove' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="variation_id" value="{{ variation.id }}">

                                    <button class="cart__remove-btn" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18">
                                            <path stroke="#888" stroke-width="1.5" d="m1.153 1.524 15.892 15.892M.99 17.415 16.882 1.523" />
                                        </svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endwith %}
                {% endfor %}
            </tbody>

            <tfoot class="cart__foot">
                <tr class="cart__row">
                    <td class="cart__col" style="vertical-align: top;">
                        <form action="{% url 'cart:clear' %}" method="POST">
                            {% csrf_token %}

                            <button class="cart__clear-btn" type="submit">
                                Очистить корзину
                            </button>
                        </form>
                    </td>
                    <td class="cart__col"></td>
                    <td class="cart__col"></td>
                    <td class="cart__col"></td>
                    <td class="cart__col" colspan="2" style="width: 1%; white-space: nowrap;">
                        <div>
                            <div>Скидка: {{ cart.discount }} ₽</div>
                        </div>
                        <div class="cart-total cart__total">
                            <div class="cart-total__label">к оплате</div>
                            <div class="cart-total__price">
                                <span class="cart-total-price">{{ cart.discounted_total_price }}</span> ₽
                            </div>
                        </div>
                        <div>
                            <a class="btn btn--gold cart__checkout-link" href="{% url 'orders:checkout' %}">
                                Оформить заказ
                            </a>
                        </div>
                    </td>
                    <td class="cart__col"></td>
                </tr>
            </tfoot>
        </table>
    {% else %}
        <a class="btn btn--gray" href="{% url 'shop:catalog' %}">
            Вернуться в магазин
        </a>
    {% endif %}
{% endblock %}
