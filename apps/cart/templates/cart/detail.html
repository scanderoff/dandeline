{% extends 'content.html' %}
{% load static %}

{% block title %}
    Корзина – {{ block.super }}
{% endblock %}


{% block heading %}
    Корзина
{% endblock %}

{% block inner %}
    {% if cart %}
        <table class="cart" style="margin-top: 50px">
            <thead class="cart__head">
                <tr>
                    <th class="cart__col">
                        Товаров: {{ cart|length }}
                    </th>
                    <th class="cart__col">
                        Размер
                    </th>
                    <th class="cart__col">
                        Количество
                    </th>
                    <th class="cart__col">
                        Стоимость
                    </th>
                    <th class="cart__col">
                        Итого
                    </th>
                    <th class="cart__col"></th>
                </tr>
            </thead>

            <tbody class="cart__body">
                {% for item in cart %}
                    {% with product=item.product %}
                        <tr class="cart__row">
                            <td class="cart__col">
                                <a class="cart-product" href="{{ product.get_absolute_url }}">
                                    <img class="cart-product__image" src="{{ product.thumbnail_url }}" alt="{{ product.name }}">

                                    <div class="cart-product__content">
                                        <div class="cart-product__title">
                                            {{ product.name }}
                                        </div>
                                        <div class="cart-product__param">
                                            Артикул: {{ product.sku }}
                                        </div>
                                    </div>
                                </a>
                            </td>
                            <td class="cart__col">
                                48
                            </td>
                            <td class="cart__col">
                                <form action="{% url 'cart:update-product' product_id=product.id %}" method="POST">
                                    {% csrf_token %}

                                    <div class="qty-input">
                                        <button class="qty-input__btn qty-input__btn--down" type="submit" name="action" value="remove">
                                            -
                                        </button>

                                        {{ item.update_form.quantity }}

                                        <button class="qty-input__btn qty-input__btn--up" type="submit" name="action" value="add">
                                            +
                                        </button>
                                    </div>
                                </form>
                            </td>
                            <td class="cart__col">
                                {{ product.price }} ₽
                            </td>
                            <td class="cart__col cart__col--bold">
                                {{ item.total_price }} ₽
                            </td>
                            <td class="cart__col">
                                <form action="{% url 'cart:remove-product' product_id=product.id %}" method="POST">
                                    {% csrf_token %}

                                    <button class="cart__remove-btn" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 18 18">
                                            <path stroke="#888" stroke-width="1.5" d="m1.153 1.524 15.892 15.892M.99 17.415 16.882 1.523" />
                                        </svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endwith %}
                {% endfor %}
            </tbody>

            <tfoot class="cart__foot">
                <tr class="cart__row">
                    <td class="cart__col" style="vertical-align: top;">
                        <button class="cart__clear-btn" type="button">
                            Очистить корзину
                        </button>
                    </td>
                    <td class="cart__col"></td>
                    <td class="cart__col"></td>
                    <td class="cart__col"></td>
                    <td class="cart__col" colspan="2" style="width: 1%; white-space: nowrap;">
                        <div>
                            <div>Скидка: {{ cart.discount }} ₽</div>
                        </div>
                        <div class="cart-total cart__total">
                            <div class="cart-total__label">к оплате</div>
                            <div class="cart-total__price">{{ cart.discounted_total_price }} ₽</div>
                        </div>
                        <div>
                            <a class="btn btn--gold cart__checkout-link" href="{% url 'orders:checkout' %}">
                                Оформить заказ
                            </a>
                        </div>
                    </td>
                    <td class="cart__col"></td>
                </tr>
            </tfoot>
        </table>
    {% else %}
        <a class="btn btn--gray" href="{% url 'shop:catalog' %}">
            Вернуться в магазин
        </a>
    {% endif %}
{% endblock %}
